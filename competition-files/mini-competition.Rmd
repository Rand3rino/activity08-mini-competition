---
title: "Activity 8 - Mini-competition"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r libraries}
library(tidyverse)
library(tidyr)
```

```{r read data}
inventory <- read.csv("data/inventory.csv")
```

```{r explore data}
summary(inventory)

n_distinct(inventory$item_no)

inventory %>% 
  group_by(item_no) %>% 
  summarise(min = min(sold),
            q1 = quantile(sold, 0.25),
            median = median(sold),
            mean = mean(sold),
            q3 = quantile(sold, 0.75),
            max = max(sold)) %>% 
  arrange(mean)
```

```{r plot data}
inventory %>% 
  filter(item_no == "A510004") %>% 
  ggplot(aes(x = week, y = sold)) +
  geom_line() +
  theme_bw()
```

```{r inventory months}
inventory_month <- inventory %>% 
  mutate(month = ceiling(week/4))
```


```{r pivot inventory}
inventory_pivot <- inventory %>% 
           #if( week == 53) {"Current"} else{ paste("WeeksAway", 53 - week, sep = "") } ) %>% 
  mutate(weeks_away = paste("WeeksAway", 53 - week, sep = "")) %>% 
  select(item_no, weeks_away, sold) %>% 
  pivot_wider(names_from=weeks_away, values_from=sold)
```

```{r model inventory}
inventory_pivot_no_item <-inventory_pivot %>% 
  select(-item_no)
model<-glm(WeeksAway0 ~ ., data = inventory_pivot_no_item)
summary(model)
```

```{r pivot month}
inventory_month_pivot <- inventory_month %>% 
  mutate(months_away = paste("MonthsAway", month, sep = "")) %>%
  group_by(item_no, months_away) %>% 
  summarise(sold = sum(sold)) %>% 
  pivot_wider(names_from=months_away, values_from=sold)
```

```{r model my month}
model<-glm(MonthsAway0 ~ . -item_no, data = inventory_month_pivot)
summary(model)
```





```{r visualize and model by sum}
org_inventory <- inventory %>% 
  group_by(week) %>% 
  summarise(sold = sum(sold)) 

org_inventory %>% 
  ggplot(aes(x=week, y=sold)) +
  geom_line() +
  theme_bw()
```

```{r org pivot}
org_inventory_pivot <- org_inventory %>%   
  mutate(weeks_away = paste("WeeksAway", 53 - week, sep = "")) %>% 
  select(weeks_away, sold) %>% 
  pivot_wider(names_from=weeks_away, values_from=sold)
```

```{r org model}
glm(WeeksAway0~ ., data = org_inventory_pivot)
```

